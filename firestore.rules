rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // ルームコレクションのルール
    match /rooms/{roomId} {
      allow read: if true;
      allow create: if request.resource.data.code is string &&
                       request.resource.data.hostId is string &&
                       request.resource.data.status is string &&
                       request.resource.data.participants is list &&
                       request.resource.data.createdAt is timestamp &&
                       request.resource.data.expiresAt is timestamp;
      allow update: if request.resource.data.code == resource.data.code &&
                       request.resource.data.hostId == resource.data.hostId &&
                       request.resource.data.createdAt == resource.data.createdAt &&
                       request.resource.data.expiresAt == resource.data.expiresAt;
      allow delete: if false;
    }
    
    // ゲームラウンドコレクションのルール
    match /gameRounds/{gameRoundId} {
      allow read: if true;
      allow create: if request.resource.data.roomId is string &&
                       request.resource.data.topicContent is string &&
                       request.resource.data.roundNumber is number &&
                       request.resource.data.status is string &&
                       request.resource.data.createdAt is timestamp;
      allow update: if request.resource.data.roomId == resource.data.roomId &&
                       request.resource.data.roundNumber == resource.data.roundNumber &&
                       request.resource.data.createdAt == resource.data.createdAt;
      allow delete: if false;
    }
    
    // 回答コレクションのルール
    match /gameAnswers/{answerId} {
      allow read: if true;
      allow create: if request.resource.data.gameRoundId is string &&
                       request.resource.data.userId is string &&
                       request.resource.data.userName is string &&
                       request.resource.data.content is string &&
                       request.resource.data.submittedAt is timestamp;
      allow update: if false;
      allow delete: if false;
    }
    
    // ユーザーコレクションのルール
    match /users/{userId} {
      allow read, write: if true;
    }
    
    // その他のコレクションへのアクセス禁止
    match /{document=**} {
      allow read, write: if false;
    }
  }
}